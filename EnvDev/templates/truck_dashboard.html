{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Dashboard | EcoTracker</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- QR Code Library -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<!-- Map Library -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Montserrat',sans-serif;color:#eaffea;background:#000;overflow-x:hidden}
canvas{position:fixed;inset:0;z-index:-3}
.overlay{position:fixed;inset:0;background:radial-gradient(circle, rgba(0,0,0,0.35), rgba(0,0,0,0.85));z-index:-2}

/* ===== SPECIAL TRUCK NAVBAR ===== */
.truck-navbar{
  position:sticky;top:0;z-index:1000;padding:15px 30px;
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(15,61,46,0.95);backdrop-filter:blur(12px);
  border-bottom:2px solid #22c55e;
}
.nav-left{display:flex;align-items:center;gap:20px}
.nav-center{flex:1;text-align:center}
.nav-right{display:flex;align-items:center;gap:15px}

/* Profile Logo */
.profile-logo{
  width:45px;height:45px;border-radius:50%;
  background:linear-gradient(135deg,#22c55e,#7ae582);
  display:flex;align-items:center;justify-content:center;
  font-size:1.3rem;color:#022c22;font-weight:bold;
  cursor:pointer;border:2px solid #7ae582;
}

/* QR Code Button */
.qr-btn{
  background:#22c55e;color:#022c22;border:none;
  padding:8px 15px;border-radius:20px;font-weight:600;
  cursor:pointer;display:flex;align-items:center;gap:8px;
  font-size:0.9rem;
}
.qr-btn:hover{background:#16a34a}

/* Notification Bell */
.notification-bell{
  position:relative;font-size:1.3rem;color:#7ae582;
  cursor:pointer;padding:8px;
}
.notification-count{
  position:absolute;top:-5px;right:-5px;
  background:#dc3545;color:white;font-size:0.7rem;
  width:18px;height:18px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:bold;
}

/* ===== TRUCK DASHBOARD LAYOUT ===== */
.truck-container{
  max-width:1400px;margin:0 auto;padding:30px 20px;
  display:grid;grid-template-columns:300px 1fr 350px;
  gap:25px;min-height:calc(100vh - 80px);
}

/* ===== LEFT SIDEBAR: DRIVER PROFILE ===== */
.driver-profile{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:25px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.profile-header{
  text-align:center;margin-bottom:25px;
  padding-bottom:20px;border-bottom:1px solid rgba(122,229,130,0.3);
}
.profile-avatar{
  width:100px;height:100px;border-radius:50%;
  background:linear-gradient(135deg,#22c55e,#7ae582);
  margin:0 auto 15px;display:flex;align-items:center;
  justify-content:center;font-size:2.5rem;
}
.profile-name{color:#7ae582;font-size:1.5rem;margin-bottom:5px}
.profile-id{color:#c8facc;font-size:0.9rem}

.driver-stats{
  margin:25px 0;
}
.stat-item{
  display:flex;justify-content:space-between;
  padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.1);
}
.stat-label{color:#c8facc}
.stat-value{color:#7ae582;font-weight:600}

.driver-actions{
  display:flex;flex-direction:column;gap:12px;margin-top:25px;
}
.action-btn{
  padding:12px;background:rgba(34,197,94,0.2);
  border:1px solid #7ae582;border-radius:12px;
  color:#7ae582;font-weight:500;cursor:pointer;
  transition:.3s;text-align:center;
}
.action-btn:hover{
  background:rgba(34,197,94,0.3);transform:translateY(-2px);
}
.action-btn.primary{
  background:#22c55e;color:#022c22;font-weight:600;
}

/* ===== CENTER: MAP & NAVIGATION ===== */
.map-navigation{
  display:flex;flex-direction:column;gap:25px;
}
.map-container{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:20px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
  flex:1;
}
.map-header{
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:20px;
}
.map-header h2{color:#7ae582;font-size:1.4rem}
#truckMap{
  height:400px;border-radius:15px;overflow:hidden;
  background:#1a1a1a;
}

.navigation-card{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:25px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.route-info{
  display:grid;grid-template-columns:1fr 1fr;gap:20px;
  margin-bottom:25px;
}
.route-point{
  background:rgba(255,255,255,0.05);padding:15px;
  border-radius:15px;border-left:4px solid #22c55e;
}
.route-label{color:#c8facc;font-size:0.9rem;margin-bottom:5px}
.route-value{color:#7ae582;font-weight:600}

.route-controls{
  display:flex;gap:15px;
}
.control-btn{
  flex:1;padding:15px;background:#22c55e;
  color:#022c22;border:none;border-radius:12px;
  font-weight:600;cursor:pointer;transition:.3s;
  display:flex;align-items:center;justify-content:center;gap:10px;
}
.control-btn:hover{background:#16a34a;transform:translateY(-2px)}
.control-btn.secondary{
  background:transparent;color:#7ae582;border:2px solid #7ae582;
}

/* ===== RIGHT SIDEBAR: NOTIFICATIONS & WASTE INFO ===== */
.notifications-sidebar{
  display:flex;flex-direction:column;gap:25px;
}

.notification-card{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:25px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.notification-header{
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:20px;
}
.notification-header h3{color:#7ae582;font-size:1.3rem}
.notification-badge{
  background:#dc3545;color:white;padding:3px 10px;
  border-radius:12px;font-size:0.8rem;font-weight:600;
}

.notification-list{
  max-height:300px;overflow-y:auto;
}
.notification-item{
  background:rgba(255,255,255,0.05);padding:15px;
  border-radius:12px;margin-bottom:12px;
  border-left:4px solid #22c55e;cursor:pointer;
  transition:.3s;
}
.notification-item:hover{
  background:rgba(255,255,255,0.1);transform:translateX(5px);
}
.notification-item.new{
  border-left-color:#dc3545;background:rgba(220,53,69,0.1);
}
.notification-title{
  color:#7ae582;font-weight:600;margin-bottom:5px;
  display:flex;justify-content:space-between;
}
.notification-time{color:#c8facc;font-size:0.8rem}
.notification-desc{color:#eaffea;font-size:0.9rem;margin-top:5px}

.waste-info{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:25px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.waste-header{
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:20px;
}
.waste-header h3{color:#7ae582;font-size:1.3rem}
.waste-type{
  display:inline-block;padding:4px 12px;
  background:rgba(34,197,94,0.2);color:#7ae582;
  border-radius:15px;font-size:0.8rem;font-weight:600;
}

.waste-details{
  display:grid;grid-template-columns:1fr 1fr;gap:15px;
  margin-bottom:20px;
}
.detail-item{
  background:rgba(255,255,255,0.05);padding:12px;
  border-radius:12px;text-align:center;
}
.detail-value{
  font-size:1.8rem;font-weight:700;color:#7ae582;
  margin-bottom:5px;
}
.detail-label{
  color:#c8facc;font-size:0.8rem;
}

/* ===== QR CODE MODAL ===== */
.qr-modal{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.8);z-index:9999;
  display:none;align-items:center;justify-content:center;
  backdrop-filter:blur(10px);
}
.qr-content{
  background:rgba(15,61,46,0.95);padding:40px;
  border-radius:25px;text-align:center;
  border:2px solid #22c55e;max-width:400px;
  width:90%;
}
.qr-code{
  width:200px;height:200px;margin:20px auto;
  background:white;padding:10px;border-radius:10px;
}
.login-status{
  margin-top:20px;padding:15px;border-radius:12px;
  font-weight:600;
}
.login-status.logged-in{
  background:rgba(34,197,94,0.2);color:#7ae582;
}
.login-status.not-logged{
  background:rgba(220,53,69,0.2);color:#ff6b6b;
}
.qr-buttons{
  display:flex;gap:15px;margin-top:25px;
}
.qr-modal-btn{
  flex:1;padding:12px;border-radius:12px;
  font-weight:600;cursor:pointer;border:none;
}
.qr-modal-btn.primary{
  background:#22c55e;color:#022c22;
}
.qr-modal-btn.secondary{
  background:transparent;color:#7ae582;
  border:2px solid #7ae582;
}

/* ===== NOTIFICATION POPUP (Like Uber) ===== */
.notification-popup{
  position:fixed;top:100px;right:30px;z-index:9998;
  background:#022c22;border-left:6px solid #22c55e;
  border-radius:15px;padding:20px;width:350px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  transform:translateX(400px);transition:transform 0.5s ease;
  backdrop-filter:blur(10px);
}
.notification-popup.show{
  transform:translateX(0);
}
.popup-header{
  display:flex;justify-content:space-between;
  align-items:center;margin-bottom:15px;
}
.popup-title{color:#7ae582;font-weight:600;font-size:1.1rem}
.popup-close{
  background:none;border:none;color:#c8facc;
  font-size:1.2rem;cursor:pointer;
}
.popup-body p{margin-bottom:15px;color:#eaffea}
.popup-actions{
  display:flex;gap:12px;margin-top:20px;
}
.popup-btn{
  flex:1;padding:10px;border-radius:10px;
  font-weight:600;cursor:pointer;border:none;
}
.popup-btn.accept{
  background:#22c55e;color:#022c22;
}
.popup-btn.decline{
  background:transparent;color:#ff6b6b;
  border:2px solid #ff6b6b;
}

/* ===== AI PREDICTION BADGE ===== */
.ai-prediction{
  position:absolute;top:20px;left:20px;z-index:400;
  background:rgba(0,0,0,0.8);padding:10px 15px;
  border-radius:10px;border-left:4px solid #9c27b0;
  backdrop-filter:blur(5px);
}
.ai-label{
  color:#9c27b0;font-size:0.8rem;font-weight:600;
  display:flex;align-items:center;gap:5px;
}
.ai-value{color:#eaffea;font-size:0.9rem;margin-top:3px}

/* ===== RESPONSIVE ===== */
@media(max-width:1200px){
  .truck-container{grid-template-columns:1fr}
  .nav-center{display:none}
}
@media(max-width:768px){
  .truck-navbar{padding:12px 20px;flex-direction:column;gap:12px}
  .nav-left,.nav-right{width:100%;justify-content:space-between}
  .route-info,.waste-details{grid-template-columns:1fr}
  .notification-popup{width:calc(100% - 40px);right:20px}
}
</style>
</head>
<body>
<canvas id="earth"></canvas>
<div class="overlay"></div>

<!-- ===== TRUCK NAVBAR ===== -->
<header class="truck-navbar">
  <div class="nav-left">
    <div class="profile-logo" onclick="toggleProfile()" title="Driver Profile">
      <i class="fas fa-user"></i>
    </div>
    <div class="nav-center">
      <h1 style="color:#7ae582;font-size:1.4rem;">üöõ EcoTruck Driver Portal</h1>
    </div>
  </div>
  
  <div class="nav-right">
    <button class="qr-btn" onclick="showQRCode()">
      <i class="fas fa-qrcode"></i> Driver QR
    </button>
    <div class="notification-bell" onclick="toggleNotifications()" title="Notifications">
      <i class="fas fa-bell"></i>
      <div class="notification-count" id="notificationCount">3</div>
    </div>
  </div>
</header>

<!-- AI PREDICTION BADGE -->
<div class="ai-prediction" id="aiPrediction">
  <div class="ai-label">
    <i class="fas fa-robot"></i> AI Prediction
  </div>
  <div class="ai-value" id="aiPredictionText">Optimal route detected</div>
</div>

<main class="truck-container">
  <!-- LEFT: DRIVER PROFILE -->
  <div class="driver-profile">
    <div class="profile-header">
      <div class="profile-avatar">
        <i class="fas fa-truck"></i>
      </div>
      <h2 class="profile-name">Rajesh Kumar</h2>
      <p class="profile-id">Driver ID: ET-7842</p>
      <p style="color:#c8facc;font-size:0.9rem;margin-top:5px;">
        <i class="fas fa-shield-alt"></i> Verified EcoDriver
      </p>
    </div>
    
    <div class="driver-stats">
      <div class="stat-item">
        <span class="stat-label">Today's Trips</span>
        <span class="stat-value">4/8</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Waste Collected</span>
        <span class="stat-value">2.4 tons</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Fuel Efficiency</span>
        <span class="stat-value">8.2 km/L</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Safety Score</span>
        <span class="stat-value">94/100</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Eco Points</span>
        <span class="stat-value">1,240</span>
      </div>
    </div>
    
    <div class="driver-actions">
      <button class="action-btn">
        <i class="fas fa-road"></i> Route History
      </button>
      <button class="action-btn">
        <i class="fas fa-chart-line"></i> Performance
      </button>
      <button class="action-btn">
        <i class="fas fa-cog"></i> Truck Settings
      </button>
      <button class="action-btn primary" onclick="startShift()">
        <i class="fas fa-play-circle"></i> Start Shift
      </button>
    </div>
  </div>

  <!-- CENTER: MAP & NAVIGATION -->
  <div class="map-navigation">
    <div class="map-container">
      <div class="map-header">
        <h2><i class="fas fa-map-marked-alt"></i> Live Navigation</h2>
        <span style="color:#c8facc;font-size:0.9rem">
          <i class="fas fa-satellite"></i> GPS Active
        </span>
      </div>
      <div id="truckMap"></div>
    </div>
    
    <div class="navigation-card">
      <div class="route-info">
        <div class="route-point">
          <div class="route-label">Pickup Location</div>
          <div class="route-value">Industrial Zone A</div>
          <div style="color:#c8facc;font-size:0.8rem;margin-top:5px">
            <i class="fas fa-clock"></i> 15 min away
          </div>
        </div>
        <div class="route-point">
          <div class="route-label">Drop-off Location</div>
          <div class="route-value">Green Recycling Plant</div>
          <div style="color:#c8facc;font-size:0.8rem;margin-top:5px">
            <i class="fas fa-road"></i> 8.2 km
          </div>
        </div>
      </div>
      
      <div class="route-controls">
        <button class="control-btn" onclick="startNavigation()">
          <i class="fas fa-directions"></i> Start Navigation
        </button>
        <button class="control-btn secondary" onclick="getAlternativeRoute()">
          <i class="fas fa-route"></i> Alt Route
        </button>
      </div>
    </div>
  </div>

  <!-- RIGHT: NOTIFICATIONS & WASTE INFO -->
  <div class="notifications-sidebar">
    <div class="notification-card">
      <div class="notification-header">
        <h3><i class="fas fa-bell"></i> Notifications</h3>
        <div class="notification-badge" id="unreadCount">3 new</div>
      </div>
      <div class="notification-list" id="notificationList">
        <!-- Notifications will be added here dynamically -->
      </div>
    </div>
    
    <div class="waste-info">
      <div class="waste-header">
        <h3><i class="fas fa-trash"></i> Current Load</h3>
        <span class="waste-type">Mixed Waste</span>
      </div>
      <div class="waste-details">
        <div class="detail-item">
          <div class="detail-value">85%</div>
          <div class="detail-label">Truck Capacity</div>
        </div>
        <div class="detail-item">
          <div class="detail-value">2.4T</div>
          <div class="detail-label">Weight</div>
        </div>
        <div class="detail-item">
          <div class="detail-value">12¬∞C</div>
          <div class="detail-label">Temperature</div>
        </div>
        <div class="detail-item">
          <div class="detail-value">OK</div>
          <div class="detail-label">Seal Status</div>
        </div>
      </div>
      <button class="action-btn primary" style="width:100%" onclick="updateWasteStatus()">
        <i class="fas fa-sync-alt"></i> Update Waste Status
      </button>
    </div>
  </div>
</main>

<!-- QR CODE MODAL -->
<div class="qr-modal" id="qrModal">
  <div class="qr-content">
    <h2 style="color:#7ae582;margin-bottom:20px">
      <i class="fas fa-qrcode"></i> Driver Authentication
    </h2>
    
    <div class="qr-code" id="qrcode"></div>
    
    <div class="login-status logged-in" id="loginStatus">
      <i class="fas fa-check-circle"></i> Logged in as Rajesh Kumar
    </div>
    
    <p style="color:#c8facc;margin:15px 0;font-size:0.9rem">
      Scan this QR at waste collection points for authentication
    </p>
    
    <div class="qr-buttons">
      <button class="qr-modal-btn secondary" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
      <button class="qr-modal-btn primary" onclick="hideQRCode()">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>
</div>

<!-- NOTIFICATION POPUP (Like Uber) -->
<div class="notification-popup" id="notificationPopup">
  <div class="popup-header">
    <div class="popup-title">
      <i class="fas fa-exclamation-circle" style="color:#22c55e"></i> New Pickup Alert!
    </div>
    <button class="popup-close" onclick="closePopup()">√ó</button>
  </div>
  <div class="popup-body">
    <p><strong>üìç Industrial Zone B</strong></p>
    <p>2.5 tons of plastic waste ready for collection</p>
    <p style="color:#7ae582;font-size:0.9rem">
      <i class="fas fa-clock"></i> Priority: High ‚Ä¢ <i class="fas fa-road"></i> 4.2 km from you
    </p>
  </div>
  <div class="popup-actions">
    <button class="popup-btn decline" onclick="declinePickup()">
      <i class="fas fa-times"></i> Decline
    </button>
    <button class="popup-btn accept" onclick="acceptPickup()">
      <i class="fas fa-check"></i> Accept
    </button>
  </div>
</div>

<!-- SPLINE ROBOT -->
<div class="spline-float">
  <spline-viewer url="https://prod.spline.design/UQEVAplfqnBX3NcV/scene.splinecode"></spline-viewer>
</div>
<script type="module" src="https://unpkg.com/@splinetool/viewer@1.12.36/build/spline-viewer.js"></script>

<script>
// ===== INITIALIZE =====
let isLoggedIn = true;
let notificationCount = 3;

// Initialize map
const map = L.map('truckMap').setView([28.6139, 77.2090], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

// Add truck marker
const truckIcon = L.divIcon({
  html: '<div style="background:#22c55e;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 0 10px rgba(34,197,94,0.5);"></div>',
  className: 'truck-marker',
  iconSize: [20, 20]
});

const truckMarker = L.marker([28.6139, 77.2090], { icon: truckIcon })
  .addTo(map)
  .bindPopup('Your Truck Location')
  .openPopup();

// Add pickup and dropoff markers
L.marker([28.62, 77.20]).addTo(map)
  .bindPopup('Pickup: Industrial Zone A<br>Plastic Waste: 1.2 tons')
  .openPopup();

L.marker([28.605, 77.205]).addTo(map)
  .bindPopup('Dropoff: Green Recycling Plant');

// Draw route line
const routeCoordinates = [
  [28.6139, 77.2090],
  [28.62, 77.20],
  [28.605, 77.205]
];

const routeLine = L.polyline(routeCoordinates, {
  color: '#22c55e',
  weight: 4,
  opacity: 0.8,
  dashArray: '10, 10'
}).addTo(map);

map.fitBounds(routeLine.getBounds());

// ===== QR CODE SYSTEM =====
function generateQRCode() {
  const driverData = {
    id: "ET-7842",
    name: "Rajesh Kumar",
    truck: "MH-04-AB-1234",
    status: isLoggedIn ? "active" : "inactive",
    timestamp: new Date().toISOString()
  };
  
  const qrData = JSON.stringify(driverData);
  const qrcodeDiv = document.getElementById('qrcode');
  qrcodeDiv.innerHTML = '';
  
  QRCode.toCanvas(qrcodeDiv, qrData, {
    width: 180,
    height: 180,
    margin: 1,
    color: {
      dark: '#022c22',
      light: '#ffffff'
    }
  });
}

function showQRCode() {
  const modal = document.getElementById('qrModal');
  const statusDiv = document.getElementById('loginStatus');
  
  generateQRCode();
  
  if (isLoggedIn) {
    statusDiv.className = 'login-status logged-in';
    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Logged in as Rajesh Kumar';
  } else {
    statusDiv.className = 'login-status not-logged';
    statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Not logged in. Please register.';
  }
  
  modal.style.display = 'flex';
}

function hideQRCode() {
  document.getElementById('qrModal').style.display = 'none';
}

function logout() {
  isLoggedIn = false;
  showQRCode();
  alert('Logged out successfully. Please scan QR at collection point to login.');
}

// ===== NOTIFICATION SYSTEM =====
const notifications = [
  {
    id: 1,
    title: "New Pickup Request",
    desc: "2.5 tons plastic waste at Industrial Zone B",
    time: "2 minutes ago",
    new: true
  },
  {
    id: 2,
    title: "Route Optimized",
    desc: "AI found faster route saving 15 minutes",
    time: "1 hour ago",
    new: true
  },
  {
    id: 3,
    title: "Maintenance Due",
    desc: "Truck service due in 500 km",
    time: "3 hours ago",
    new: true
  },
  {
    id: 4,
    title: "Payment Received",
    desc: "‚Çπ12,500 credited for last week's collections",
    time: "1 day ago",
    new: false
  }
];

function updateNotificationList() {
  const list = document.getElementById('notificationList');
  const count = document.getElementById('notificationCount');
  const unread = document.getElementById('unreadCount');
  
  list.innerHTML = '';
  let unreadCount = 0;
  
  notifications.forEach(notif => {
    if (notif.new) unreadCount++;
    
    const item = document.createElement('div');
    item.className = `notification-item ${notif.new ? 'new' : ''}`;
    item.innerHTML = `
      <div class="notification-title">
        ${notif.title}
        <span style="color:#c8facc;font-size:0.8rem">${notif.time}</span>
      </div>
      <div class="notification-desc">${notif.desc}</div>
    `;
    item.onclick = () => markAsRead(notif.id);
    list.appendChild(item);
  });
  
  count.textContent = unreadCount;
  unread.textContent = `${unreadCount} new`;
}

function markAsRead(id) {
  const index = notifications.findIndex(n => n.id === id);
  if (index !== -1) {
    notifications[index].new = false;
    updateNotificationList();
  }
}

function toggleNotifications() {
  updateNotificationList();
  // Could open a notifications panel
}

// ===== UBER-STYLE POPUP NOTIFICATION =====
function showUberNotification() {
  const popup = document.getElementById('notificationPopup');
  popup.classList.add('show');
  
  // Auto-hide after 30 seconds
  setTimeout(() => {
    if (popup.classList.contains('show')) {
      closePopup();
    }
  }, 30000);
}

function closePopup() {
  document.getElementById('notificationPopup').classList.remove('show');
}

function acceptPickup() {
  alert('Pickup accepted! Added to your route.');
  closePopup();
  
  // Add new notification
  notifications.unshift({
    id: notifications.length + 1,
    title: "Pickup Accepted",
    desc: "Industrial Zone B added to your route",
    time: "Just now",
    new: true
  });
  updateNotificationList();
}

function declinePickup() {
  alert('Pickup declined.');
  closePopup();
}

// ===== AI PREDICTION SYSTEM =====
const aiPredictions = [
  "Traffic ahead, consider alternative route",
  "Optimal route detected via ring road",
  "Weather alert: Rain expected in 30 minutes",
  "Collection point congestion, delay pickup",
  "Fuel-efficient route available"
];

function updateAIPrediction() {
  const prediction = aiPredictions[Math.floor(Math.random() * aiPredictions.length)];
  document.getElementById('aiPredictionText').textContent = prediction;
  
  // Change color based on urgency
  const badge = document.getElementById('aiPrediction');
  if (prediction.includes("alert") || prediction.includes("congestion")) {
    badge.style.borderLeftColor = '#dc3545';
  } else if (prediction.includes("Optimal") || prediction.includes("efficient")) {
    badge.style.borderLeftColor = '#22c55e';
  } else {
    badge.style.borderLeftColor = '#9c27b0';
  }
}

// ===== TRUCK FUNCTIONS =====
function startShift() {
  alert('Shift started! GPS tracking activated.');
  document.querySelector('.action-btn.primary').innerHTML = '<i class="fas fa-stop-circle"></i> End Shift';
  document.querySelector('.action-btn.primary').onclick = endShift;
  
  // Show first notification after 5 seconds
  setTimeout(showUberNotification, 5000);
  
  // Update AI prediction every 30 seconds
  setInterval(updateAIPrediction, 30000);
}

function endShift() {
  alert('Shift ended. Report generated.');
  document.querySelector('.action-btn.primary').innerHTML = '<i class="fas fa-play-circle"></i> Start Shift';
  document.querySelector('.action-btn.primary').onclick = startShift;
}

function startNavigation() {
  alert('Navigation started to Industrial Zone A');
  // In real app, this would integrate with Google Maps/Apple Maps
}

function getAlternativeRoute() {
  const newPrediction = "Alternative route via Nehru Road saves 8 minutes";
  document.getElementById('aiPredictionText').textContent = newPrediction;
  alert('AI found alternative route! Check prediction badge.');
}

function updateWasteStatus() {
  const capacity = Math.floor(Math.random() * 20) + 80;
  const weight = (Math.random() * 1.5 + 1.5).toFixed(1);
  
  document.querySelector('.detail-item:nth-child(1) .detail-value').textContent = `${capacity}%`;
  document.querySelector('.detail-item:nth-child(2) .detail-value').textContent = `${weight}T`;
  
  alert(`Waste status updated:\nCapacity: ${capacity}%\nWeight: ${weight} tons`);
}

function toggleProfile() {
  // Could show expanded profile modal
  alert('Driver Profile:\nRajesh Kumar\n5 years experience\nSpecialized in hazardous waste\nSafety rating: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ');
}

// ===== THREE.JS EARTH BACKGROUND =====
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById('earth'),
  alpha: true,
  antialias: true
});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);

const geometry = new THREE.SphereGeometry(2.8, 32, 32);
const texture = new THREE.TextureLoader().load(
  "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg"
);
const material = new THREE.MeshStandardMaterial({ map: texture });
const globe = new THREE.Mesh(geometry, material);
scene.add(globe);

const light = new THREE.PointLight(0xffffff, 1.5);
light.position.set(5, 5, 5);
scene.add(light);

camera.position.z = 5.2;

function animate() {
  requestAnimationFrame(animate);
  globe.rotation.y += 0.002;
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

// ===== INITIALIZE EVERYTHING =====
window.onload = function() {
  updateNotificationList();
  updateAIPrediction();
  generateQRCode();
  
  // Show first notification after 3 seconds
  setTimeout(showUberNotification, 3000);
  
  // Update AI prediction every minute
  setInterval(updateAIPrediction, 60000);
};
</script>
</body>
</html>