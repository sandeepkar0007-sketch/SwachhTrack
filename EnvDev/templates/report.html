{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Report Issue | EcoTracker</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Montserrat',sans-serif;color:#eaffea;background:#000;overflow-x:hidden}
canvas{position:fixed;inset:0;z-index:-3}
.overlay{position:fixed;inset:0;background:radial-gradient(circle, rgba(0,0,0,0.35), rgba(0,0,0,0.85));z-index:-2}

.navbar{
  position:sticky;top:0;z-index:1000;padding:18px 60px;
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(15,61,46,0.9);backdrop-filter:blur(12px);
}
.navbar h1{color:#eaffea;font-size:1.8rem}
.navbar nav a{
  margin-left:30px;text-decoration:none;color:#c8facc;
  font-weight:500;position:relative;
}
.navbar nav a::after{
  content:"";position:absolute;width:0;height:2px;
  bottom:-6px;left:0;background:#7ae582;transition:.3s;
}
.navbar nav a:hover::after{width:100%}
.navbar nav a.active{color:#7ae582}

/* Report Page Layout */
.report-container{
  max-width:1200px;margin:0 auto;padding:40px 20px;
}
.report-header{
  text-align:center;margin-bottom:40px;
}
.report-header h2{
  font-size:2.5rem;color:#7ae582;margin-bottom:15px;
}
.report-header p{
  font-size:1.1rem;color:#c8facc;max-width:700px;margin:0 auto;
}

/* Report Type Selection */
.report-type-selection{
  display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
  gap:20px;margin-bottom:40px;
}
.type-card{
  background:rgba(255,255,255,0.08);border-radius:20px;
  padding:30px;text-align:center;cursor:pointer;
  transition:.3s;border:2px solid transparent;
  backdrop-filter:blur(10px);
}
.type-card:hover{
  transform:translateY(-5px);border-color:#7ae582;
  background:rgba(122,229,130,0.1);
}
.type-card.active{
  background:rgba(34,197,94,0.2);border-color:#22c55e;
  box-shadow:0 10px 30px rgba(34,197,94,0.2);
}
.type-icon{
  font-size:2.5rem;margin-bottom:15px;
}
.type-card h3{color:#7ae582;margin-bottom:10px}

/* Report Form */
.report-form{
  background:rgba(255,255,255,0.08);border-radius:25px;
  padding:40px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.form-section{
  margin-bottom:30px;
}
.form-section h3{
  color:#7ae582;margin-bottom:20px;padding-bottom:10px;
  border-bottom:1px solid rgba(122,229,130,0.3);
}
.form-row{
  display:grid;grid-template-columns:1fr 1fr;gap:25px;
  margin-bottom:20px;
}
.form-group{
  margin-bottom:20px;
}
.form-group label{
  display:block;margin-bottom:8px;color:#c8facc;
  font-weight:500;
}
.form-group input,
.form-group select,
.form-group textarea{
  width:100%;padding:14px;background:rgba(255,255,255,0.1);
  border:1px solid rgba(122,229,130,0.3);border-radius:12px;
  color:#fff;font-family:inherit;font-size:1rem;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus{
  outline:none;border-color:#22c55e;
  box-shadow:0 0 0 3px rgba(34,197,94,0.2);
}
.form-group textarea{
  min-height:120px;resize:vertical;
}

/* Severity Slider */
.severity-slider{
  margin:20px 0 30px;
}
.severity-labels{
  display:flex;justify-content:space-between;margin-bottom:10px;
}
.severity-label{
  text-align:center;font-size:0.9rem;color:#c8facc;
}
.severity-indicator{
  width:100%;height:8px;background:linear-gradient(90deg, #22c55e, #ffc107, #dc3545);
  border-radius:4px;margin:10px 0;
}
.severity-marker{
  width:20px;height:20px;background:#fff;border:3px solid #22c55e;
  border-radius:50%;position:relative;top:-14px;left:0;
  cursor:grab;
}

/* Photo Upload */
.photo-upload{
  border:2px dashed rgba(122,229,130,0.3);border-radius:15px;
  padding:40px;text-align:center;cursor:pointer;
  transition:.3s;margin-top:20px;
}
.photo-upload:hover{
  border-color:#7ae582;background:rgba(122,229,130,0.05);
}
.upload-icon{font-size:3rem;color:#7ae582;margin-bottom:15px}
.upload-text{color:#c8facc;margin-bottom:10px}
.upload-note{font-size:0.9rem;color:#888}

/* Location Picker */
.location-picker{
  height:250px;background:#1a1a1a;border-radius:15px;
  display:flex;align-items:center;justify-content:center;
  margin-top:15px;border:2px solid rgba(122,229,130,0.2);
}
.location-picker i{font-size:3rem;color:#7ae582}
.location-buttons{
  display:flex;gap:15px;margin-top:15px;
}
.location-btn{
  flex:1;padding:12px;background:rgba(34,197,94,0.2);
  border:1px solid #7ae582;border-radius:10px;
  color:#7ae582;font-weight:500;cursor:pointer;
  transition:.3s;
}
.location-btn:hover{background:rgba(34,197,94,0.3)}

/* Submit Section */
.submit-section{
  text-align:center;margin-top:40px;padding-top:30px;
  border-top:1px solid rgba(122,229,130,0.2);
}
.submit-btn{
  background:#22c55e;color:#022c22;border:none;
  padding:16px 40px;border-radius:15px;font-size:1.1rem;
  font-weight:600;cursor:pointer;transition:.3s;
  display:inline-flex;align-items:center;gap:10px;
}
.submit-btn:hover{
  background:#16a34a;transform:translateY(-3px);
  box-shadow:0 10px 25px rgba(34,197,94,0.3);
}
.submit-note{
  color:#c8facc;font-size:0.9rem;margin-top:15px;
}

/* Success Message */
.success-message{
  display:none;background:rgba(34,197,94,0.15);
  border:1px solid #22c55e;border-radius:15px;
  padding:30px;text-align:center;margin-top:30px;
}
.success-icon{font-size:4rem;color:#22c55e;margin-bottom:20px}
.success-message h3{color:#7ae582;margin-bottom:15px}

/* Spline & Chatbot */
.spline-float{
  position:fixed;bottom:18px;right:18px;width:130px;height:130px;
  z-index:999;cursor:pointer;
}
.chatbot{
  position:fixed;bottom:210px;right:20px;width:280px;
  background:#fff;border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.4);
  transform:scale(0);opacity:0;transition:.4s;z-index:998;
}
.chatbot.active{transform:scale(1);opacity:1}
.chat-header{
  background:#0f3d2e;color:#eaffea;padding:14px;
  display:flex;justify-content:space-between;
  border-radius:18px 18px 0 0;
}
.chat-body{padding:15px;height:180px;overflow-y:auto}
.bot-msg{background:#e6f9ea;padding:12px;border-radius:15px 15px 15px 5px;margin-bottom:8px}
.user-msg{
  background:#22c55e;color:#fff;padding:12px;
  border-radius:15px 15px 5px 15px;margin-bottom:8px;margin-left:auto;
}
.chat-input{display:flex;border-top:1px solid #ddd}
.chat-input input{flex:1;border:none;padding:10px}
.chat-input button{background:#22c55e;border:none;padding:10px;color:white}

@media(max-width:768px){
  .navbar{padding:15px 25px;flex-direction:column;gap:15px}
  .navbar nav{display:flex;flex-wrap:wrap;justify-content:center;gap:15px}
  .navbar nav a{margin:0}
  .report-container{padding:25px 15px}
  .form-row{grid-template-columns:1fr}
  .type-card{padding:20px}
}
</style>
</head>
<body>
<canvas id="earth"></canvas>
<div class="overlay"></div>

<header class="navbar">
  <h1>SwachhTrack</h1>
  <nav>
    <a href="{% url 'index' %}">Home</a>
    <a href="{% url 'dashboard' %}">Dashboard</a>
    <a href="{% url 'map' %}">Map</a>
    <a href="{% url 'report' %}" class="active">Report</a>
    <a href="{% url 'analytics' %}">Analytics</a>
    <a href="{% url 'about' %}">About</a>
    <a href="{% url 'contact' %}">Contact</a>
  </nav>
</header>

<main class="report-container">
  <div class="report-header">
    <h2><i class="fas fa-bullhorn"></i> Report Environmental Issue</h2>
    <p>Your report helps us identify pollution hotspots and take action. Together we can make a difference!</p>
  </div>

  <div class="report-type-selection">
    <div class="type-card active" data-type="air">
      <div class="type-icon">üå´Ô∏è</div>
      <h3>Air Pollution</h3>
      <p>Smoke, dust, industrial emissions</p>
    </div>
    <div class="type-card" data-type="water">
      <div class="type-icon">üíß</div>
      <h3>Water Pollution</h3>
      <p>Chemical spills, sewage, litter</p>
    </div>
    <div class="type-card" data-type="waste">
      <div class="type-icon">üóëÔ∏è</div>
      <h3>Illegal Dumping</h3>
      <p>Construction waste, garbage</p>
    </div>
    <div class="type-card" data-type="noise">
      <div class="type-icon">üîä</div>
      <h3>Noise Pollution</h3>
      <p>Industrial noise, traffic</p>
    </div>
  </div>

  <form class="report-form" id="reportForm">
    <div class="form-section">
      <h3>Location Details</h3>
      <div class="form-row">
        <div class="form-group">
          <label><i class="fas fa-map-marker-alt"></i> Address</label>
          <input type="text" placeholder="Enter street address" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-city"></i> City</label>
          <input type="text" placeholder="Enter city" required>
        </div>
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-map-pin"></i> Pin Location on Map</label>
        <div class="location-picker">
          <i class="fas fa-map-marked-alt"></i>
        </div>
        <div class="location-buttons">
          <button type="button" class="location-btn">
            <i class="fas fa-location-crosshairs"></i> Use My Location
          </button>
          <button type="button" class="location-btn">
            <i class="fas fa-search-location"></i> Search on Map
          </button>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Issue Details</h3>
      <div class="form-group">
        <label><i class="fas fa-heading"></i> Title</label>
        <input type="text" placeholder="Brief description of the issue" required>
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-align-left"></i> Description</label>
        <textarea placeholder="Provide detailed information about what you observed..." required></textarea>
      </div>

      <div class="form-group">
        <label><i class="fas fa-exclamation-triangle"></i> Severity Level</label>
        <div class="severity-slider">
          <div class="severity-labels">
            <div class="severity-label">Low</div>
            <div class="severity-label">Medium</div>
            <div class="severity-label">High</div>
            <div class="severity-label">Critical</div>
          </div>
          <div class="severity-indicator">
            <div class="severity-marker" id="severityMarker"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Evidence</h3>
      <div class="form-group">
        <label><i class="fas fa-camera"></i> Upload Photos</label>
        <div class="photo-upload" id="photoUpload">
          <div class="upload-icon">
            <i class="fas fa-cloud-upload-alt"></i>
          </div>
          <div class="upload-text">
            <strong>Click to upload photos</strong>
            <p class="upload-note">Upload up to 5 photos (Max 5MB each)</p>
          </div>
          <input type="file" id="photoInput" accept="image/*" multiple style="display:none">
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Your Contact (Optional)</h3>
      <div class="form-row">
        <div class="form-group">
          <label><i class="fas fa-user"></i> Name</label>
          <input type="text" placeholder="Your name">
        </div>
        <div class="form-group">
          <label><i class="fas fa-envelope"></i> Email</label>
          <input type="email" placeholder="email@example.com">
        </div>
      </div>
      <div class="form-group">
        <label><i class="fas fa-phone"></i> Phone</label>
        <input type="tel" placeholder="(Optional)">
      </div>
    </div>

    <div class="submit-section">
      <button type="submit" class="submit-btn">
        <i class="fas fa-paper-plane"></i> Submit Report
      </button>
      <p class="submit-note">
        <i class="fas fa-shield-alt"></i> Your report will be reviewed and added to our public map within 24 hours.
      </p>
    </div>
  </form>

  <div class="success-message" id="successMessage">
    <div class="success-icon">‚úÖ</div>
    <h3>Report Submitted Successfully!</h3>
    <p>Thank you for contributing to environmental protection. Your report ID is <strong>#EC2025-8472</strong></p>
    <p>We'll notify you when action is taken on this issue.</p>
    <button class="submit-btn" style="margin-top:20px" onclick="location.href='map.html'">
      <i class="fas fa-map"></i> View on Map
    </button>
  </div>
</main>

<div class="spline-float">
  <spline-viewer url="https://prod.spline.design/UQEVAplfqnBX3NcV/scene.splinecode"></spline-viewer>
</div>
<script type="module" src="https://unpkg.com/@splinetool/viewer@1.12.36/build/spline-viewer.js"></script>

<div class="chatbot" id="chatbot">
  <div class="chat-header">üìù Report Assistant <span onclick="toggleChat()">‚úñ</span></div>
  <div class="chat-body" id="chat-body">
    <div class="bot-msg">I can help you fill out the report! What type of environmental issue are you reporting?</div>
  </div>
  <div class="chat-input">
    <input id="user-input" placeholder="Ask about reporting...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// Report Type Selection
document.querySelectorAll('.type-card').forEach(card => {
  card.addEventListener('click', function() {
    document.querySelectorAll('.type-card').forEach(c => c.classList.remove('active'));
    this.classList.add('active');
  });
});

// Severity Slider
const marker = document.getElementById('severityMarker');
const indicator = document.querySelector('.severity-indicator');
let isDragging = false;

marker.addEventListener('mousedown', startDrag);
document.addEventListener('mousemove', drag);
document.addEventListener('mouseup', stopDrag);

function startDrag(e) {
  isDragging = true;
  marker.style.cursor = 'grabbing';
}

function drag(e) {
  if (!isDragging) return;
  
  const rect = indicator.getBoundingClientRect();
  let x = e.clientX - rect.left;
  x = Math.max(0, Math.min(x, rect.width));
  
  const percent = (x / rect.width) * 100;
  marker.style.left = `calc(${percent}% - 10px)`;
}

function stopDrag() {
  isDragging = false;
  marker.style.cursor = 'grab';
}

// Photo Upload
const photoUpload = document.getElementById('photoUpload');
const photoInput = document.getElementById('photoInput');

photoUpload.addEventListener('click', () => {
  photoInput.click();
});

photoInput.addEventListener('change', function() {
  if(this.files.length > 0) {
    photoUpload.innerHTML = `
      <div class="upload-icon">
        <i class="fas fa-check-circle" style="color:#22c55e"></i>
      </div>
      <div class="upload-text">
        <strong>${this.files.length} photo(s) selected</strong>
        <p class="upload-note">Click to change photos</p>
      </div>
    `;
  }
});

// Form Submission
document.getElementById('reportForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // Show success message
  document.getElementById('successMessage').style.display = 'block';
  this.style.display = 'none';
  
  // Scroll to success message
  document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
});

// Chatbot
function toggleChat(){
  document.getElementById("chatbot").classList.toggle("active");
}
document.querySelector(".spline-float").onclick = toggleChat;

function sendMessage(){
  const input = document.getElementById("user-input");
  const chatBody = document.getElementById("chat-body");
  
  if(input.value.trim()){
    const userMsg = document.createElement("div");
    userMsg.className = "user-msg";
    userMsg.textContent = input.value;
    chatBody.appendChild(userMsg);
    
    setTimeout(() => {
      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      const responses = [
        "For air pollution reports, please include details about the source (factory, vehicles, etc.) and any visible smoke or odors.",
        "When reporting water pollution, photos are very helpful. Try to show the source if possible.",
        "Illegal dumping reports are most effective when you can identify who is doing it or the type of waste.",
        "Noise pollution reports should include time of day and duration of the noise.",
        "Remember: Your exact location helps authorities respond faster. Use the map pin feature for accuracy."
      ];
      botMsg.textContent = responses[Math.floor(Math.random() * responses.length)];
      chatBody.appendChild(botMsg);
      chatBody.scrollTop = chatBody.scrollHeight;
    }, 600);
    
    input.value = "";
    chatBody.scrollTop = chatBody.scrollHeight;
  }
}

// Three.js Earth
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById("earth"),
  alpha: true,
  antialias: true
});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);

const geometry = new THREE.SphereGeometry(2.8, 32, 32);
const texture = new THREE.TextureLoader().load(
  "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg"
);
const material = new THREE.MeshStandardMaterial({ map: texture });
const globe = new THREE.Mesh(geometry, material);
scene.add(globe);

const light = new THREE.PointLight(0xffffff, 1.5);
light.position.set(5, 5, 5);
scene.add(light);

camera.position.z = 5.2;

function animate() {
  requestAnimationFrame(animate);
  globe.rotation.y += 0.002;
  renderer.render(scene, camera);
}
animate();

addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>