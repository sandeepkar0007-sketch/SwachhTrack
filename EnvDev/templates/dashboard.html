{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | EcoTracker</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Montserrat',sans-serif;color:#eaffea;background:#000;overflow-x:hidden}
canvas{position:fixed;inset:0;z-index:-3}
.overlay{position:fixed;inset:0;background:radial-gradient(circle, rgba(0,0,0,0.35), rgba(0,0,0,0.85));z-index:-2}

.navbar{
  position:sticky;top:0;z-index:1000;padding:18px 60px;
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(15,61,46,0.9);backdrop-filter:blur(12px);
}
.navbar h1{color:#eaffea;font-size:1.8rem}
.navbar nav a{
  margin-left:30px;text-decoration:none;color:#c8facc;
  font-weight:500;position:relative;
}
.navbar nav a::after{
  content:"";position:absolute;width:0;height:2px;
  bottom:-6px;left:0;background:#7ae582;transition:.3s;
}
.navbar nav a:hover::after{width:100%}
.navbar nav a.active{color:#7ae582}

/* Dashboard Layout */
.dashboard-header{
  padding:40px 60px 20px;
  display:flex;justify-content:space-between;align-items:center;
}
.dashboard-header h2{font-size:2.2rem;color:#7ae582}
.date-display{color:#c8facc;font-size:1.1rem}

/* Grid Layout */
.dashboard-grid{
  display:grid;grid-template-columns:repeat(12, 1fr);
  gap:25px;padding:0 60px 60px;min-height:70vh;
}

/* Large Cards - Span 6 columns */
.card-large{
  grid-column:span 6;background:rgba(255,255,255,0.08);
  border-radius:25px;padding:30px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.card-large h3{color:#7ae582;margin-bottom:25px;font-size:1.5rem}

/* Medium Cards - Span 4 columns */
.card-medium{
  grid-column:span 4;background:rgba(255,255,255,0.08);
  border-radius:25px;padding:25px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}
.card-medium h3{color:#7ae582;margin-bottom:20px}

/* Small Cards - Span 3 columns */
.card-small{
  grid-column:span 3;background:rgba(255,255,255,0.08);
  border-radius:20px;padding:20px;backdrop-filter:blur(15px);
  border:1px solid rgba(122,229,130,0.1);
}

/* Mini Map */
.mini-map{
  height:250px;border-radius:15px;overflow:hidden;
  background:#1a1a1a;margin-top:15px;
  display:flex;align-items:center;justify-content:center;
}
.mini-map i{font-size:3rem;color:#7ae582}

/* Stats Cards */
.stats-container{
  display:grid;grid-template-columns:1fr 1fr;gap:15px;
}
.stat-item{
  background:rgba(34,197,94,0.15);padding:15px;
  border-radius:15px;text-align:center;
}
.stat-value{
  font-size:2rem;font-weight:700;color:#7ae582;
  margin-bottom:5px;
}
.stat-label{font-size:0.9rem;color:#c8facc}

/* Progress Bars */
.progress-container{margin-top:20px}
.progress-item{
  margin-bottom:15px;
}
.progress-header{
  display:flex;justify-content:space-between;
  margin-bottom:8px;
}
.progress-bar{
  height:8px;background:rgba(255,255,255,0.1);
  border-radius:4px;overflow:hidden;
}
.progress-fill{
  height:100%;background:linear-gradient(90deg, #22c55e, #7ae582);
  border-radius:4px;
}

/* Activity Feed */
.activity-feed{max-height:300px;overflow-y:auto}
.activity-item{
  display:flex;align-items:center;gap:15px;
  padding:15px;background:rgba(255,255,255,0.05);
  border-radius:12px;margin-bottom:12px;
}
.activity-icon{
  width:40px;height:40px;border-radius:50%;
  background:rgba(34,197,94,0.2);display:flex;
  align-items:center;justify-content:center;
  font-size:1.2rem;
}
.activity-details{flex:1}
.activity-details p{margin:5px 0;font-size:0.9rem}
.activity-time{color:#7ae582;font-size:0.8rem}

/* Quick Actions */
.quick-actions{
  display:grid;grid-template-columns:1fr 1fr;gap:15px;
  margin-top:20px;
}
.action-btn{
  background:#22c55e;color:#022c22;border:none;
  padding:15px;border-radius:15px;font-weight:600;
  cursor:pointer;transition:.3s;display:flex;
  align-items:center;justify-content:center;gap:10px;
}
.action-btn:hover{background:#16a34a;transform:translateY(-3px)}
.action-btn.secondary{
  background:transparent;color:#7ae582;
  border:2px solid #7ae582;
}

/* Weather Widget */
.weather-widget{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:20px;
}
.weather-icon{font-size:3rem;color:#7ae582}
.temperature{font-size:2.5rem;font-weight:700;color:#7ae582}
.weather-details{color:#c8facc;font-size:0.9rem}

/* Alert Banner */
.alert-banner{
  background:linear-gradient(90deg, rgba(220,53,69,0.2), rgba(220,53,69,0.1));
  border-left:5px solid #dc3545;padding:15px;
  border-radius:10px;margin:20px 60px;
  display:flex;align-items:center;gap:15px;
}
.alert-banner i{color:#dc3545;font-size:1.5rem}
.alert-content{flex:1}
.alert-content p{margin:5px 0}

/* Spline & Chatbot */
.spline-float{
  position:fixed;bottom:18px;right:18px;width:130px;height:130px;
  z-index:999;cursor:pointer;
}
.chatbot{
  position:fixed;bottom:210px;right:20px;width:280px;
  background:#fff;border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.4);
  transform:scale(0);opacity:0;transition:.4s;z-index:998;
}
.chatbot.active{transform:scale(1);opacity:1}
.chat-header{
  background:#0f3d2e;color:#eaffea;padding:14px;
  display:flex;justify-content:space-between;
  border-radius:18px 18px 0 0;
}
.chat-body{padding:15px;height:180px;overflow-y:auto}
.bot-msg{background:#e6f9ea;padding:12px;border-radius:15px 15px 15px 5px;margin-bottom:8px}
.user-msg{
  background:#22c55e;color:#fff;padding:12px;
  border-radius:15px 15px 5px 15px;margin-bottom:8px;margin-left:auto;
}
.chat-input{display:flex;border-top:1px solid #ddd}
.chat-input input{flex:1;border:none;padding:10px}
.chat-input button{background:#22c55e;border:none;padding:10px;color:white}

/* Responsive */
@media(max-width:1400px){
  .dashboard-grid{grid-template-columns:repeat(6, 1fr)}
  .card-large{grid-column:span 3}
  .card-medium{grid-column:span 2}
  .card-small{grid-column:span 2}
}
@media(max-width:992px){
  .dashboard-grid{grid-template-columns:1fr;padding:0 25px 40px}
  .card-large,.card-medium,.card-small{grid-column:span 1}
  .navbar{padding:15px 25px;flex-direction:column;gap:15px}
  .navbar nav{display:flex;flex-wrap:wrap;justify-content:center;gap:15px}
  .navbar nav a{margin:0}
  .dashboard-header{padding:30px 25px 20px;flex-direction:column;gap:15px}
  .alert-banner{margin:20px 25px}
}
</style>
</head>
<body>
<canvas id="earth"></canvas>
<div class="overlay"></div>

<header class="navbar">
  <h1>SwachhTrack</h1>
  <nav>
    <a href="{% url 'index' %}">Home</a>
    <a href="{% url 'dashboard' %}" class="active">Dashboard</a>
    <a href="{% url 'map' %}">Map</a>
    <a href="{% url 'report' %}">Report</a>
    <a href="{% url 'analytics' %}">Analytics</a>
    <a href="{% url 'about' %}">About</a>
    <a href="{% url 'contact' %}">Contact</a>
  </nav>
</header>

<div class="alert-banner">
  <i class="fas fa-exclamation-triangle"></i>
  <div class="alert-content">
    <strong>High Pollution Alert</strong>
    <p>Industrial zone air quality index is at 156 (Unhealthy). Avoid outdoor activities in affected areas.</p>
  </div>
  <button class="action-btn" style="padding:8px 15px;font-size:0.9rem">View Details</button>
</div>

<section class="dashboard-header">
  <div>
    <h2>Welcome back, Alex!</h2>
    <p>Your environmental impact summary</p>
  </div>
  <div class="date-display">
    <i class="far fa-calendar"></i> Thursday, March 27, 2025
  </div>
</section>

<main class="dashboard-grid">
  <!-- Area Health Overview -->
  <div class="card-large">
    <h3><i class="fas fa-heartbeat"></i> Area Health Overview</h3>
    <div class="stats-container">
      <div class="stat-item">
        <div class="stat-value">78</div>
        <div class="stat-label">Overall Score</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">A-</div>
        <div class="stat-label">Air Quality Grade</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">B+</div>
        <div class="stat-label">Water Quality</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">85%</div>
        <div class="stat-label">Green Cover</div>
      </div>
    </div>
    <div class="progress-container">
      <div class="progress-item">
        <div class="progress-header">
          <span>Environmental Improvement</span>
          <span>+12%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:65%"></div>
        </div>
      </div>
      <div class="progress-item">
        <div class="progress-header">
          <span>Community Participation</span>
          <span>78%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:78%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Your Impact -->
  <div class="card-large">
    <h3><i class="fas fa-chart-line"></i> Your Environmental Impact</h3>
    <div class="stats-container">
      <div class="stat-item">
        <div class="stat-value">24</div>
        <div class="stat-label">Reports Filed</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">850</div>
        <div class="stat-label">Eco Points</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">#42</div>
        <div class="stat-label">Global Rank</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">7</div>
        <div class="stat-label">Day Streak</div>
      </div>
    </div>
    <div class="progress-container">
      <div class="progress-item">
        <div class="progress-header">
          <span>Monthly Goal</span>
          <span>15/20 reports</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:75%"></div>
        </div>
      </div>
      <div class="progress-item">
        <div class="progress-header">
          <span>Carbon Footprint Reduction</span>
          <span>1.2 tons</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:40%"></div>
        </div>
      </div>
    </div>
    <div class="quick-actions">
      <button class="action-btn" onclick="location.href='report.html'">
        <i class="fas fa-plus"></i> New Report
      </button>
      <button class="action-btn secondary">
        <i class="fas fa-share-alt"></i> Share Impact
      </button>
    </div>
  </div>

  <!-- Quick Map -->
  <div class="card-medium">
    <h3><i class="fas fa-map-marked-alt"></i> Pollution Hotspots</h3>
    <div class="mini-map">
      <i class="fas fa-map"></i>
    </div>
    <div style="margin-top:15px">
      <p><i class="fas fa-circle" style="color:#22c55e"></i> 3 Low severity</p>
      <p><i class="fas fa-circle" style="color:#ffc107"></i> 5 Medium severity</p>
      <p><i class="fas fa-circle" style="color:#dc3545"></i> 2 High severity</p>
    </div>
    <button class="action-btn" onclick="location.href='map.html'" style="margin-top:15px;width:100%">
      <i class="fas fa-external-link-alt"></i> Open Full Map
    </button>
  </div>

  <!-- Weather & Conditions -->
  <div class="card-medium">
    <h3><i class="fas fa-cloud-sun"></i> Weather & Conditions</h3>
    <div class="weather-widget">
      <div class="weather-icon">
        <i class="fas fa-sun"></i>
      </div>
      <div class="temperature">24Â°C</div>
    </div>
    <div class="weather-details">
      <p><i class="fas fa-wind"></i> Wind: 12 km/h NW</p>
      <p><i class="fas fa-tint"></i> Humidity: 65%</p>
      <p><i class="fas fa-leaf"></i> Pollen: Low</p>
      <p><i class="fas fa-smog"></i> UV Index: Moderate</p>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="card-medium">
    <h3><i class="fas fa-history"></i> Recent Activity</h3>
    <div class="activity-feed">
      <div class="activity-item">
        <div class="activity-icon" style="background:rgba(34,197,94,0.2)">
          <i class="fas fa-water" style="color:#22c55e"></i>
        </div>
        <div class="activity-details">
          <strong>Water quality report submitted</strong>
          <p>Riverside Park area</p>
          <div class="activity-time">2 hours ago</div>
        </div>
      </div>
      <div class="activity-item">
        <div class="activity-icon" style="background:rgba(255,193,7,0.2)">
          <i class="fas fa-trash" style="color:#ffc107"></i>
        </div>
        <div class="activity-details">
          <strong>Illegal dumping confirmed</strong>
          <p>Green Valley Road</p>
          <div class="activity-time">Yesterday</div>
        </div>
      </div>
      <div class="activity-item">
        <div class="activity-icon" style="background:rgba(220,53,69,0.2)">
          <i class="fas fa-industry" style="color:#dc3545"></i>
        </div>
        <div class="activity-details">
          <strong>Air pollution alert</strong>
          <p>Industrial zone</p>
          <div class="activity-time">2 days ago</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="card-small">
    <h4><i class="fas fa-tree"></i> Trees Saved</h4>
    <div class="stat-value">124</div>
    <p style="font-size:0.9rem;color:#c8facc">This month</p>
  </div>
  <div class="card-small">
    <h4><i class="fas fa-recycle"></i> Waste Diverted</h4>
    <div class="stat-value">845 kg</div>
    <p style="font-size:0.9rem;color:#c8facc">From landfill</p>
  </div>
  <div class="card-small">
    <h4><i class="fas fa-tint"></i> Water Saved</h4>
    <div class="stat-value">24.5k L</div>
    <p style="font-size:0.9rem;color:#c8facc">Through reports</p>
  </div>
  <div class="card-small">
    <h4><i class="fas fa-users"></i> Volunteers</h4>
    <div class="stat-value">156</div>
    <p style="font-size:0.9rem;color:#c8facc">Active in area</p>
  </div>
</main>

<div class="spline-float">
  <spline-viewer url="https://prod.spline.design/UQEVAplfqnBX3NcV/scene.splinecode"></spline-viewer>
</div>
<script type="module" src="https://unpkg.com/@splinetool/viewer@1.12.36/build/spline-viewer.js"></script>

<div class="chatbot" id="chatbot">
  <div class="chat-header">ðŸŒ± Dashboard Assistant <span onclick="toggleChat()">âœ–</span></div>
  <div class="chat-body" id="chat-body">
    <div class="bot-msg">Hello Alex! Your environmental score improved by 5% this week. Want tips to improve it further?</div>
  </div>
  <div class="chat-input">
    <input id="user-input" placeholder="Ask about your dashboard...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// Update date
const now = new Date();
const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
document.querySelector('.date-display').innerHTML = `<i class="far fa-calendar"></i> ${now.toLocaleDateString('en-US', options)}`;

// Animate stats
function animateStats() {
  const stats = document.querySelectorAll('.stat-value');
  stats.forEach(stat => {
    const finalValue = parseInt(stat.textContent);
    if(!isNaN(finalValue)) {
      let start = 0;
      const increment = finalValue / 20;
      const timer = setInterval(() => {
        start += increment;
        if(start >= finalValue) {
          stat.textContent = finalValue.toLocaleString();
          clearInterval(timer);
        } else {
          stat.textContent = Math.floor(start).toLocaleString();
        }
      }, 50);
    }
  });
}
setTimeout(animateStats, 500);

// Chatbot
function toggleChat(){
  document.getElementById("chatbot").classList.toggle("active");
}
document.querySelector(".spline-float").onclick = toggleChat;

function sendMessage(){
  const input = document.getElementById("user-input");
  const chatBody = document.getElementById("chat-body");
  
  if(input.value.trim()){
    const userMsg = document.createElement("div");
    userMsg.className = "user-msg";
    userMsg.textContent = input.value;
    chatBody.appendChild(userMsg);
    
    setTimeout(() => {
      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      const responses = [
        "Your area's environmental score is 78/100. To improve it, consider reporting the construction dust issue on Main Street.",
        "You're in the top 15% of contributors! Keep up the great work. Your reports have helped reduce pollution by 12% in your area.",
        "Based on your activity, I recommend focusing on water pollution reports. There's a 40% increase in river contamination this month.",
        "Your carbon footprint is 1.2 tons below the area average. Excellent! Consider sharing your sustainable practices with the community.",
        "There's a cleanup event this weekend that matches your interests. Would you like me to sign you up?"
      ];
      botMsg.textContent = responses[Math.floor(Math.random() * responses.length)];
      chatBody.appendChild(botMsg);
      chatBody.scrollTop = chatBody.scrollHeight;
    }, 600);
    
    input.value = "";
    chatBody.scrollTop = chatBody.scrollHeight;
  }
}

// Three.js Earth
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById("earth"),
  alpha: true,
  antialias: true
});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);

const geometry = new THREE.SphereGeometry(2.8, 32, 32);
const texture = new THREE.TextureLoader().load(
  "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg"
);
const material = new THREE.MeshStandardMaterial({ map: texture });
const globe = new THREE.Mesh(geometry, material);
scene.add(globe);

const light = new THREE.PointLight(0xffffff, 1.5);
light.position.set(5, 5, 5);
scene.add(light);

camera.position.z = 5.2;

function animate() {
  requestAnimationFrame(animate);
  globe.rotation.y += 0.002;
  renderer.render(scene, camera);
}
animate();

addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>